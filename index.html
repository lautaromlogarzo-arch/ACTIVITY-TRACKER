<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tracker de Desempeño - FSAE & Training</title>
    
    <link rel="icon" type="image/png" href="logo.png">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <style>
        /* ... (El resto del CSS sigue igual que antes) ... */
        :root {
            --primary: #d62828; /* Rojo estilo FSAE/Racing */
            --dark: #1e1e1e;
            --light: #f4f4f4;
            --success: #2ecc71;
            --bg: #121212;
            --card: #1e1e24;
        }

        body {
            font-family: 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            background-color: var(--bg);
            color: var(--light);
            display: flex;
            flex-direction: column;
            height: 100vh;
        }
        
        /* --- Header --- */
        header {
            background-color: var(--card);
            padding: 15px;
            text-align: center;
            border-bottom: 3px solid var(--primary);
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        /* Clase opcional si quieres usar la imagen también en el header */
        .header-logo-img {
            height: 24px;
            width: auto;
        }

        h1 { margin: 0; font-size: 1.2rem; text-transform: uppercase; letter-spacing: 1px; }

        /* ... (Resto del CSS) ... */
        /* --- Navegación (Tabs) --- */
        nav { display: flex; background: var(--card); }
        .tab-btn { flex: 1; padding: 15px; background: none; border: none; color: #888; font-weight: bold; cursor: pointer; transition: 0.3s; border-bottom: 2px solid transparent; text-transform: uppercase; font-size: 0.9rem; }
        .tab-btn.active { color: var(--primary); border-bottom: 2px solid var(--primary); background: rgba(214, 40, 40, 0.1); }
        .tab-btn i { margin-right: 8px; }
        /* --- Contenido --- */
        main { flex: 1; overflow-y: auto; padding: 20px; max-width: 600px; width: 100%; margin: 0 auto; box-sizing: border-box; }
        .tab-content { display: none; animation: fadeIn 0.3s; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        /* --- Estilos Tab: Ingreso --- */
        .date-picker-container { text-align: center; margin-bottom: 25px; }
        input[type="date"] { background: var(--card); color: white; border: 1px solid #444; padding: 10px; border-radius: 8px; font-size: 1.1rem; font-family: inherit; }
        .task-list { display: flex; flex-direction: column; gap: 15px; }
        .task-item { background: var(--card); padding: 15px; border-radius: 10px; display: flex; align-items: center; justify-content: space-between; border: 1px solid #333; transition: transform 0.1s; }
        .task-item:active { transform: scale(0.98); }
        .task-label { font-size: 1.1rem; font-weight: 500; }
        .task-icon { font-size: 1.5rem; margin-right: 15px; width: 30px; text-align: center; }
        /* Checkbox personalizado */
        .custom-checkbox { width: 25px; height: 25px; border: 2px solid #555; border-radius: 5px; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: 0.2s; }
        .custom-checkbox.checked { background-color: var(--success); border-color: var(--success); }
        .custom-checkbox i { color: white; display: none; font-size: 0.9rem; }
        .custom-checkbox.checked i { display: block; }
        /* --- Estilos Tab: Desempeño --- */
        .chart-container { background: var(--card); padding: 15px; border-radius: 12px; height: 300px; position: relative; }
        .stats-summary { display: flex; justify-content: space-around; margin-bottom: 20px; }
        .stat-box { background: var(--card); padding: 10px 20px; border-radius: 8px; text-align: center; border-top: 3px solid var(--primary); }
        .stat-val { font-size: 1.5rem; font-weight: bold; display: block; }
        .stat-lbl { font-size: 0.8rem; color: #aaa; }
        /* --- Estilos Tab: Historial --- */
        .history-list { list-style: none; padding: 0; }
        .history-item { background: var(--card); margin-bottom: 10px; padding: 15px; border-radius: 8px; display: flex; justify-content: space-between; align-items: center; border-left: 4px solid #555; }
        /* Colores segun porcentaje */
        .score-0 { border-left-color: #555; }
        .score-33 { border-left-color: #e74c3c; } /* Rojo */
        .score-66 { border-left-color: #f1c40f; } /* Amarillo */
        .score-100 { border-left-color: #2ecc71; } /* Verde */
        .hist-date { font-weight: bold; color: #fff; }
        .hist-details { font-size: 0.85rem; color: #aaa; margin-top: 4px; }
        .hist-score { font-weight: bold; font-size: 1.2rem; }
        /* Utilidades */
        .hidden { display: none; }
        @media (max-width: 480px) {
            .tab-btn span { display: none; }
            .tab-btn i { margin: 0; font-size: 1.2rem; }
        }
    </style>
</head>
<body>

    <header>
        <h1><i class="fa-solid fa-flag-checkered" style="color:var(--primary)"></i> Performance Tracker</h1>
    </header>

    <nav>
        <button class="tab-btn active" onclick="openTab('ingreso')">
            <i class="fa-solid fa-pen-to-square"></i> <span>Ingreso</span>
        </button>
        <button class="tab-btn" onclick="openTab('desempeno')">
            <i class="fa-solid fa-chart-line"></i> <span>Desempeño</span>
        </button>
        <button class="tab-btn" onclick="openTab('historial')">
            <i class="fa-solid fa-clock-rotate-left"></i> <span>Historial</span>
        </button>
    </nav>

    <main>
        <div id="ingreso" class="tab-content active">
            <div class="date-picker-container">
                <label style="display:block; margin-bottom:5px; color:#aaa;">Seleccionar Fecha:</label>
                <input type="date" id="dateInput" onchange="loadDayData()">
                <div id="todayIndicator" style="margin-top:5px; font-size:0.8rem; color:var(--primary); font-weight:bold; display:none;">
                    DÍA DE HOY
                </div>
            </div>

            <div class="task-list">
                <div class="task-item" onclick="toggleTask('train')">
                    <div style="display:flex; align-items:center;">
                        <div class="task-icon" style="color: #3498db;"><i class="fa-solid fa-dumbbell"></i></div>
                        <span class="task-label">Entrenamiento Físico</span>
                    </div>
                    <div class="custom-checkbox" id="check-train"><i class="fa-solid fa-check"></i></div>
                </div>
                <div class="task-item" onclick="toggleTask('fsae')">
                    <div style="display:flex; align-items:center;">
                        <div class="task-icon" style="color: var(--primary);"><i class="fa-solid fa-car-side"></i></div>
                        <span class="task-label">Proyecto FSAE</span>
                    </div>
                    <div class="custom-checkbox" id="check-fsae"><i class="fa-solid fa-check"></i></div>
                </div>
                <div class="task-item" onclick="toggleTask('stretch')">
                    <div style="display:flex; align-items:center;">
                        <div class="task-icon" style="color: #f1c40f;"><i class="fa-solid fa-person-walking"></i></div>
                        <span class="task-label">Rutina Estiramiento</span>
                    </div>
                    <div class="custom-checkbox" id="check-stretch"><i class="fa-solid fa-check"></i></div>
                </div>
            </div>
            <p style="text-align:center; color:#555; margin-top:30px; font-size:0.8rem;">Los datos se guardan automáticamente.</p>
        </div>

        <div id="desempeno" class="tab-content">
            <div class="stats-summary">
                <div class="stat-box"><span class="stat-val" id="totalDays">0</span><span class="stat-lbl">Días Registrados</span></div>
                <div class="stat-box"><span class="stat-val" id="avgPerf">0%</span><span class="stat-lbl">Promedio Global</span></div>
            </div>
            <h3 style="margin-bottom:10px;">Curva de Progreso</h3>
            <div class="chart-container"><canvas id="performanceChart"></canvas></div>
            <div style="margin-top:20px; text-align:center; font-size:0.8rem; color:#aaa;">
                <i class="fa-solid fa-circle" style="color:#2ecc71"></i> 100% (3/3) &nbsp;
                <i class="fa-solid fa-circle" style="color:#f1c40f"></i> 66% (2/3) &nbsp;
                <i class="fa-solid fa-circle" style="color:#e74c3c"></i> 33% (1/3)
            </div>
        </div>

        <div id="historial" class="tab-content">
            <h3 style="margin-bottom:15px;">Registro Diario</h3>
            <ul class="history-list" id="historyList"></ul>
        </div>
    </main>

    <script>
        // --- CONSTANTES Y ESTADO ---
        const STORAGE_KEY = 'fsae_tracker_data_v1';
        let appData = JSON.parse(localStorage.getItem(STORAGE_KEY)) || {};
        let currentDateSelected = '';
        let myChart = null;

        // --- INICIALIZACIÓN ---
        window.onload = function() {
            const today = new Date().toISOString().split('T')[0];
            const dateInput = document.getElementById('dateInput');
            dateInput.max = today;
            dateInput.value = today;
            currentDateSelected = today;
            loadDayData();
        };

        // --- LÓGICA DE TABS ---
        function openTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            const btn = document.querySelector(`button[onclick="openTab('${tabName}')"]`);
            if(btn) btn.classList.add('active');
            if(tabName === 'desempeno') renderChart();
            if(tabName === 'historial') renderHistory();
        }

        // --- LÓGICA DE DATOS (INPUT) ---
        function loadDayData() {
            const dateInput = document.getElementById('dateInput');
            currentDateSelected = dateInput.value;
            const today = new Date().toISOString().split('T')[0];
            const indicator = document.getElementById('todayIndicator');
            if(currentDateSelected === today) { indicator.style.display = 'block'; } else { indicator.style.display = 'none'; }
            if(currentDateSelected > today) { alert("No puedes registrar datos del futuro."); dateInput.value = today; currentDateSelected = today; }
            const dayData = appData[currentDateSelected] || { train: false, fsae: false, stretch: false };
            updateCheckboxUI('check-train', dayData.train);
            updateCheckboxUI('check-fsae', dayData.fsae);
            updateCheckboxUI('check-stretch', dayData.stretch);
        }

        function toggleTask(taskName) {
            const dayData = appData[currentDateSelected] || { train: false, fsae: false, stretch: false };
            dayData[taskName] = !dayData[taskName];
            appData[currentDateSelected] = dayData;
            localStorage.setItem(STORAGE_KEY, JSON.stringify(appData));
            updateCheckboxUI(`check-${taskName}`, dayData[taskName]);
        }

        function updateCheckboxUI(elementId, isChecked) {
            const el = document.getElementById(elementId);
            if(isChecked) { el.classList.add('checked'); } else { el.classList.remove('checked'); }
        }

        // --- LÓGICA DE DESEMPEÑO (CHART) ---
        function calculatePercentage(dayObj) {
            if(!dayObj) return 0;
            let count = 0;
            if(dayObj.train) count++;
            if(dayObj.fsae) count++;
            if(dayObj.stretch) count++;
            if(count === 0) return 0;
            if(count === 1) return 33;
            if(count === 2) return 66;
            if(count === 3) return 100;
            return 0;
        }

        function renderChart() {
            const ctx = document.getElementById('performanceChart').getContext('2d');
            const sortedDates = Object.keys(appData).sort();
            const dataPoints = sortedDates.map(date => { return calculatePercentage(appData[date]); });
            const labels = sortedDates.map(date => { const parts = date.split('-'); return `${parts[2]}/${parts[1]}`; });
            document.getElementById('totalDays').innerText = sortedDates.length;
            const sum = dataPoints.reduce((a, b) => a + b, 0);
            const avg = sortedDates.length ? Math.round(sum / sortedDates.length) : 0;
            document.getElementById('avgPerf').innerText = avg + "%";
            if(myChart) myChart.destroy();
            let gradient = ctx.createLinearGradient(0, 0, 0, 400);
            gradient.addColorStop(0, 'rgba(214, 40, 40, 0.5)');
            gradient.addColorStop(1, 'rgba(214, 40, 40, 0.0)');
            myChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Desempeño Diario (%)',
                        data: dataPoints,
                        borderColor: '#d62828',
                        backgroundColor: gradient,
                        borderWidth: 2,
                        pointBackgroundColor: '#fff',
                        pointRadius: 4,
                        fill: true,
                        tension: 0.3
                    }]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    scales: {
                        y: { beginAtZero: true, max: 105, ticks: { color: '#888' }, grid: { color: '#333' } },
                        x: { ticks: { color: '#888' }, grid: { display: false } }
                    },
                    plugins: { legend: { display: false } }
                }
            });
        }

        // --- LÓGICA DE HISTORIAL ---
        function renderHistory() {
            const list = document.getElementById('historyList');
            list.innerHTML = '';
            const sortedDates = Object.keys(appData).sort().reverse();
            if(sortedDates.length === 0) { list.innerHTML = '<li style="text-align:center; color:#555;">No hay registros aún.</li>'; return; }
            sortedDates.forEach(date => {
                const data = appData[date];
                const score = calculatePercentage(data);
                const dateObj = new Date(date);
                const userTimezoneOffset = dateObj.getTimezoneOffset() * 60000;
                const localDate = new Date(dateObj.getTime() + userTimezoneOffset);
                const options = { weekday: 'short', year: 'numeric', month: 'long', day: 'numeric' };
                const dateString = localDate.toLocaleDateString('es-ES', options);
                let detailsHTML = '';
                if(data.train) detailsHTML += '<i class="fa-solid fa-dumbbell" title="Entrenado"></i> ';
                if(data.fsae) detailsHTML += '<i class="fa-solid fa-car-side" title="FSAE"></i> ';
                if(data.stretch) detailsHTML += '<i class="fa-solid fa-person-walking" title="Estirado"></i> ';
                if(detailsHTML === '') detailsHTML = 'Descanso / Sin actividad';
                let scoreClass = 'score-0'; let scoreColor = '#555';
                if(score >= 33) { scoreClass = 'score-33'; scoreColor = '#e74c3c'; }
                if(score >= 66) { scoreClass = 'score-66'; scoreColor = '#f1c40f'; }
                if(score >= 100) { scoreClass = 'score-100'; scoreColor = '#2ecc71'; }
                const li = document.createElement('li');
                li.className = `history-item ${scoreClass}`;
                li.onclick = () => { document.getElementById('dateInput').value = date; openTab('ingreso'); loadDayData(); };
                li.style.cursor = 'pointer';
                li.innerHTML = `<div><div class="hist-date">${dateString}</div><div class="hist-details">${detailsHTML}</div></div><div class="hist-score" style="color:${scoreColor}">${score}%</div>`;
                list.appendChild(li);
            });
        }
    </script>
</body>
</html>